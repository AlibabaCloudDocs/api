# 如何保证幂等性？ {#concept_bxl_njj_ndb .concept}

在调用阿里云API创建实例时，可以通过ClientToken参数保证请求的等幂性。

当通过调用接口在阿里云中创建云产品实例时，如果遇到了请求超时或服务器内部错误时，客户端可能会尝试重发请求，导致创建了多于预期的云产品实例。为了避免这种情况，客户端可以通过提供可选参数ClientToken避免服务器创建出比预期要多的实例，即通过提供ClientToken参数保证请求的幂等性。ClientToken参数是一个由客户端生成的唯一的、大小写敏感、不超过64个ASCII字符的字符串。

如果您的两次请求使用同一个ClientToken参数值调用创建云产品实例的接口，则服务端会返回相同的请求结果，包含相同的InstanceId。因此您在遇到错误进行重试的时候，可以通过提供相同的ClientToken值，来确保只创建一个云产品实例，并得到这个实例的ID。

需要注意的是，每个请求的SignatureNonce、Timestamp和Signature参数不能相同。因为阿里云使用SignatureNonce来防止重放攻击，使用Timestamp来标记每次请求时间，所以再次请求必须提供不同的SignatureNonce和Timestamp参数值，这同时也会导致Signature参数值的变化。

通常，客户端只需要对HTTP状态码为500（InternetError）或503（ServiceUnavailable\)，以及无法得到响应结果的情况下进行重试操作。HTTP状态码为200时，重试可以得到上次相同的结果，但不会对服务端状态带来任何影响。而对HTTP状态码为4xx的返回错误，通常重试也是不能成功的。

如果用户提供了一个已经使用过的ClientToken，但其他请求参数不同，那么服务端会返回错误码`IdempotentParameterMismatch`。

